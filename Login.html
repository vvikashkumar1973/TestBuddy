<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login / Sign Up - TestBuddy.in</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body class="text-gray-800">
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="index.html" class="text-2xl font-bold text-blue-600">TestBuddy</a>
            <div class="hidden md:flex items-center space-x-8">
                <a href="index.html" class="nav-link text-gray-600 hover:text-blue-600 font-medium">Home</a>
                <a href="Tests.html" class="nav-link text-gray-600 hover:text-blue-600 font-medium">Tests</a>
                <a href="TypingBuddy.html" class="nav-link text-gray-600 hover:text-blue-600 font-medium">Typing Test</a>
                <a href="Analytics.html" class="nav-link text-gray-600 hover:text-blue-600 font-medium">Analytics</a>
                <a href="About.html" class="nav-link text-gray-600 hover:text-blue-600 font-medium">About</a>
                <a href="Contact.html" class="nav-link text-gray-600 hover:text-blue-600 font-medium">Contact</a>
            </div>
            <div class="flex items-center space-x-4">
                <a href="Login.html" class="bg-blue-600 text-white px-5 py-2 rounded-lg font-semibold cta-button">Login / Sign Up</a>
            </div>
        </nav>
    </header>

    <main>
        <section class="hero-section py-12 md:py-16">
            <div class="container mx-auto px-6">
                <div class="max-w-lg mx-auto bg-white rounded-xl shadow-lg p-6 md:p-8">
                    <div id="tab-container" class="flex gap-2 bg-gray-100 p-1 rounded-lg w-full md:w-fit mx-auto mb-6">
                        <button id="tab-login" class="flex-1 md:flex-none px-4 py-2 rounded-md bg-white text-gray-900 font-semibold">Login</button>
                        <button id="tab-signup" class="flex-1 md:flex-none px-4 py-2 rounded-md text-gray-600">Sign Up</button>
                    </div>

                    <!-- Login Form -->
                    <form id="form-login" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" name="email" class="w-full rounded-md border-gray-300 focus:border-blue-600 focus:ring-blue-600" placeholder="you@example.com">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                            <input type="password" name="password" class="w-full rounded-md border-gray-300 focus:border-blue-600 focus:ring-blue-600" placeholder="Your password">
                        </div>
                        <button type="submit" class="w-full bg-blue-600 text-white px-5 py-2.5 rounded-lg font-semibold cta-button">Login</button>
                    </form>

                    <!-- Sign Up Form -->
                    <form id="form-signup" class="space-y-4 hidden">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                            <input type="text" name="name" class="w-full rounded-md border-gray-300" placeholder="Your name" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" name="email" class="w-full rounded-md border-gray-300" placeholder="you@example.com" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                            <input type="password" name="password" class="w-full rounded-md border-gray-300" placeholder="Create a password" required>
                        </div>
                        <button type="submit" class="w-full bg-green-600 text-white px-5 py-2.5 rounded-lg font-semibold cta-button">Create Account</button>
                    </form>

                    <!-- Verification Form -->
                    <div id="form-verify" class="hidden">
                         <h2 class="text-2xl font-bold text-center mb-4">Verify Your Email</h2>
                         <p class="text-center text-gray-600 mb-4">A verification code has been "sent" to your email. Please enter it below to complete your registration.</p>
                         <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Verification Code</label>
                                <input type="text" id="verify-code" class="w-full text-center tracking-widest text-lg rounded-md border-gray-300" placeholder="_ _ _ _ _ _" required>
                                <p id="verify-error" class="text-red-500 text-sm mt-1 hidden"></p>
                            </div>
                            <button id="verify-btn" type="button" class="w-full bg-indigo-600 text-white px-5 py-2.5 rounded-lg font-semibold cta-button">Verify & Create Account</button>
                            <p class="text-center text-xs text-gray-500">(For this demo, the code is <strong class="text-gray-700">123456</strong>)</p>
                         </div>
                    </div>

                    <p class="text-center text-sm text-gray-600 mt-4">By continuing, you agree to our <a href="#" class="text-blue-600 hover:underline">Terms</a> and <a href="#" class="text-blue-600 hover:underline">Privacy Policy</a>.</p>
                </div>
            </div>
        </section>
    </main>
    
    <script>
        (function(){
            const tabLogin = document.getElementById('tab-login');
            const tabSignup = document.getElementById('tab-signup');
            const tabContainer = document.getElementById('tab-container');
            const formLogin = document.getElementById('form-login');
            const formSignup = document.getElementById('form-signup');
            const formVerify = document.getElementById('form-verify');
            const verifyCodeInput = document.getElementById('verify-code');
            const verifyBtn = document.getElementById('verify-btn');
            const verifyError = document.getElementById('verify-error');

            const urlParams = new URLSearchParams(window.location.search);
            const redirectUrl = urlParams.get('redirect') || 'index.html';
            
            let tempNewUser = null;

            function activateTab(tab){
                const isLogin = tab === 'login';
                tabLogin.classList.toggle('bg-white', isLogin);
                tabLogin.classList.toggle('text-gray-900', isLogin);
                tabLogin.classList.toggle('text-gray-600', !isLogin);
                tabSignup.classList.toggle('bg-white', !isLogin);
                tabSignup.classList.toggle('text-gray-900', !isLogin);
                tabSignup.classList.toggle('text-gray-600', isLogin);
                formLogin.classList.toggle('hidden', !isLogin);
                formSignup.classList.toggle('hidden', isLogin);
                formVerify.classList.add('hidden');
            }

            tabLogin.addEventListener('click', () => activateTab('login'));
            tabSignup.addEventListener('click', () => activateTab('signup'));

            async function handleLogin(e) {
                e.preventDefault();
                // In a real app, you'd verify credentials against your user data.
                // For this demo, we assume the pre-filled "aarav@example.com" is a valid user.
                const email = formLogin.querySelector('input[name="email"]').value;
                
                // Fetch all users to find the matching one
                const response = await fetch('assets/data/users.json');
                const users = await response.json();
                const user = users.users.find(u => u.email === email);
                const userId = user ? user.id : 'u_001'; // Default to u_001 if not found

                localStorage.setItem('tb_logged_in', 'true');
                localStorage.setItem('tb_current_user_id', userId);
                window.location.href = redirectUrl;
            }

            function handleSignup(e) {
                e.preventDefault();
                tempNewUser = {
                    name: formSignup.querySelector('input[name="name"]').value,
                    email: formSignup.querySelector('input[name="email"]').value,
                };
                
                // Hide other forms and show verification form
                formLogin.classList.add('hidden');
                formSignup.classList.add('hidden');
                tabContainer.classList.add('hidden');
                formVerify.classList.remove('hidden');
                verifyCodeInput.focus();
            }

            async function handleVerification() {
                const code = verifyCodeInput.value;
                const correctCode = '123456';

                if (code === correctCode) {
                    verifyError.classList.add('hidden');
                    
                    // --- This part simulates creating and saving a new user ---
                    // 1. Generate a new user ID
                    const newUserId = 'u_' + String(Date.now()).slice(-3);

                    // 2. Create the new user object
                    const newUser = {
                        id: newUserId,
                        name: tempNewUser.name,
                        email: tempNewUser.email,
                        // ... other default user properties
                    };
                    
                    // 3. In a real app, you'd POST this to your server.
                    // Here, we just log it and proceed.
                    console.log("Simulating new user creation:", newUser);

                    // 4. Log the user in
                    localStorage.setItem('tb_logged_in', 'true');
                    localStorage.setItem('tb_current_user_id', newUserId);
                    window.location.href = redirectUrl;

                } else {
                    verifyError.textContent = "Invalid verification code. Please try again.";
                    verifyError.classList.remove('hidden');
                    verifyCodeInput.focus();
                }
            }

            formLogin.addEventListener('submit', handleLogin);
            formSignup.addEventListener('submit', handleSignup);
            verifyBtn.addEventListener('click', handleVerification);
        })();
    </script>
</body>
</html>


